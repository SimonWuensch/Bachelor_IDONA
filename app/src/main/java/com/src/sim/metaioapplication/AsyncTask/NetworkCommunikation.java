package com.src.sim.metaioapplication.asynctask;

import android.os.AsyncTask;
import android.text.TextUtils;
import android.util.Log;

import com.src.sim.metaioapplication.listener.CustomListener;
import com.src.sim.metaioapplication.logic.resource.Location;
import com.src.sim.metaioapplication.ui.activitiy.start.StartMenuActivity;
import com.src.sim.metaioapplication.ui.fragment.location.ListLocationFragment;

import org.apache.commons.io.IOUtils;

import java.io.InputStream;
import java.net.CookieManager;
import java.net.HttpCookie;
import java.net.HttpURLConnection;
import java.net.URL;
import java.util.List;
import java.util.Map;

/**
 * Created by Simon on 22.05.2015.
 */
public class NetworkCommunikation extends AsyncTask<String, Void, String> {

    private static String PROTOCOL = "http://";
    private CookieManager msCookieManager;
    private StartMenuActivity activity;
    private CustomListener customListener;

    public NetworkCommunikation(StartMenuActivity activity){
        super();
        this.activity = activity;
        this.customListener = (CustomListener) activity;
    }

    public static void getLocation(StartMenuActivity activity){
        NetworkCommunikation netCom = new NetworkCommunikation(activity);
        netCom.execute();
    }

    @Override
    protected String doInBackground(String... params) {
        //doGetRequest("address");
        //return "{\"history\":{\"lObjectMap\":[{\"key\":\"ROOM\",\"value\":[{\"description\":\"C\",\"kind\":\"ROOM\"},{\"description\":\"E\",\"kind\":\"ROOM\"},{\"description\":\"Q\",\"kind\":\"ROOM\"},{\"description\":\"A\",\"kind\":\"ROOM\"},{\"description\":\"S\",\"kind\":\"ROOM\"},{\"description\":\"R\",\"kind\":\"ROOM\"},{\"description\":\"H\",\"kind\":\"ROOM\"},{\"description\":\"T\",\"kind\":\"ROOM\"},{\"description\":\"G\",\"kind\":\"ROOM\"},{\"description\":\"M\",\"kind\":\"ROOM\"},{\"description\":\"D\",\"kind\":\"ROOM\"},{\"description\":\"F\",\"kind\":\"ROOM\"},{\"description\":\"N\",\"kind\":\"ROOM\"},{\"description\":\"J\",\"kind\":\"ROOM\"},{\"description\":\"B\",\"kind\":\"ROOM\"},{\"description\":\"L\",\"kind\":\"ROOM\"},{\"description\":\"K\",\"kind\":\"ROOM\"}]},{\"key\":\"TOILET\",\"value\":[{\"description\":\"HANDICAPPED\",\"kind\":\"TOILET\"},{\"description\":\"MALE\",\"kind\":\"TOILET\"},{\"description\":\"FEMAIL\",\"kind\":\"TOILET\"}]}],\"trackerMap\":{\"1\":{\"directions\":[{\"distance\":6,\"locationObjectMap\":[{\"key\":\"ROOM\",\"value\":[{\"description\":\"C\",\"kind\":\"ROOM\"},{\"description\":\"E\",\"kind\":\"ROOM\"},{\"description\":\"Q\",\"kind\":\"ROOM\"}]},{\"key\":\"FIREDRENCHER\",\"value\":[{\"description\":\"FIREDRENCHER\",\"kind\":\"FIREDRENCHER\"}]}],\"locationObjects\":{\"lefthand\":[{\"key\":{\"description\":\"C\",\"kind\":\"ROOM\"},\"value\":1},{\"key\":{\"description\":\"E\",\"kind\":\"ROOM\"},\"value\":5}],\"righthand\":[{\"key\":{\"description\":\"FIREDRENCHER\",\"kind\":\"FIREDRENCHER\"},\"value\":4},{\"key\":{\"description\":\"Q\",\"kind\":\"ROOM\"},\"value\":2}]},\"arrow\":\"LEFT\",\"trackerID\":2},{\"distance\":8,\"locationObjectMap\":[{\"key\":\"TOILET\",\"value\":[{\"description\":\"HANDICAPPED\",\"kind\":\"TOILET\"}]},{\"key\":\"ROOM\",\"value\":[{\"description\":\"A\",\"kind\":\"ROOM\"}]},{\"key\":\"MEDIKIT\",\"value\":[{\"description\":\"MEDIKIT\",\"kind\":\"MEDIKIT\"}]}],\"locationObjects\":{\"lefthand\":[{\"key\":{\"description\":\"HANDICAPPED\",\"kind\":\"TOILET\"},\"value\":2}],\"righthand\":[{\"key\":{\"description\":\"A\",\"kind\":\"ROOM\"},\"value\":3},{\"key\":{\"description\":\"MEDIKIT\",\"kind\":\"MEDIKIT\"},\"value\":5}]},\"arrow\":\"RIGHT\",\"trackerID\":6},{\"distance\":4,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"BACKWARDS\",\"trackerID\":9}],\"id\":1,\"trackers\":[2,6,9]},\"2\":{\"directions\":[{\"distance\":6,\"locationObjectMap\":[{\"key\":\"ROOM\",\"value\":[{\"description\":\"C\",\"kind\":\"ROOM\"},{\"description\":\"E\",\"kind\":\"ROOM\"},{\"description\":\"Q\",\"kind\":\"ROOM\"}]},{\"key\":\"FIREDRENCHER\",\"value\":[{\"description\":\"FIREDRENCHER\",\"kind\":\"FIREDRENCHER\"}]}],\"locationObjects\":{\"lefthand\":[{\"key\":{\"description\":\"FIREDRENCHER\",\"kind\":\"FIREDRENCHER\"},\"value\":2},{\"key\":{\"description\":\"Q\",\"kind\":\"ROOM\"},\"value\":4}],\"righthand\":[{\"key\":{\"description\":\"C\",\"kind\":\"ROOM\"},\"value\":5},{\"key\":{\"description\":\"E\",\"kind\":\"ROOM\"},\"value\":1}]},\"arrow\":\"LEFT\",\"trackerID\":1},{\"distance\":0,\"locationObjectMap\":[{\"key\":\"ROOM\",\"value\":[{\"description\":\"S\",\"kind\":\"ROOM\"},{\"description\":\"R\",\"kind\":\"ROOM\"}]}],\"locationObjects\":{\"lefthand\":[{\"key\":{\"description\":\"S\",\"kind\":\"ROOM\"},\"value\":1}],\"righthand\":[{\"key\":{\"description\":\"R\",\"kind\":\"ROOM\"},\"value\":1}]},\"arrow\":\"BACKWARDS\",\"trackerID\":0},{\"distance\":2,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"RIGHT\",\"trackerID\":3}],\"id\":2,\"trackers\":[1,3]},\"3\":{\"directions\":[{\"distance\":2,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"RIGHT\",\"trackerID\":2},{\"distance\":8,\"locationObjectMap\":[{\"key\":\"ROOM\",\"value\":[{\"description\":\"H\",\"kind\":\"ROOM\"},{\"description\":\"T\",\"kind\":\"ROOM\"}]}],\"locationObjects\":{\"lefthand\":[{\"key\":{\"description\":\"H\",\"kind\":\"ROOM\"},\"value\":5}],\"righthand\":[{\"key\":{\"description\":\"T\",\"kind\":\"ROOM\"},\"value\":3}]},\"arrow\":\"LEFT\",\"trackerID\":5},{\"distance\":5,\"locationObjectMap\":[{\"key\":\"ROOM\",\"value\":[{\"description\":\"G\",\"kind\":\"ROOM\"}]}],\"locationObjects\":{\"lefthand\":[],\"righthand\":[{\"key\":{\"description\":\"G\",\"kind\":\"ROOM\"},\"value\":2}]},\"arrow\":\"BACKWARDS\",\"trackerID\":10},{\"distance\":4,\"locationObjectMap\":[{\"key\":\"ROOM\",\"value\":[{\"description\":\"G\",\"kind\":\"ROOM\"}]}],\"locationObjects\":{\"lefthand\":[],\"righthand\":[{\"key\":{\"description\":\"G\",\"kind\":\"ROOM\"},\"value\":2}]},\"arrow\":\"BACKWARDS\",\"trackerID\":11}],\"id\":3,\"trackers\":[2,5,10,11]},\"4\":{\"directions\":[{\"distance\":2,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"RIGHT\",\"trackerID\":9},{\"distance\":5,\"locationObjectMap\":[{\"key\":\"ROOM\",\"value\":[{\"description\":\"M\",\"kind\":\"ROOM\"},{\"description\":\"F\",\"kind\":\"ROOM\"},{\"description\":\"D\",\"kind\":\"ROOM\"}]},{\"key\":\"MEDIKIT\",\"value\":[{\"description\":\"MEDIKIT\",\"kind\":\"MEDIKIT\"}]}],\"locationObjects\":{\"lefthand\":[{\"key\":{\"description\":\"M\",\"kind\":\"ROOM\"},\"value\":2},{\"key\":{\"description\":\"MEDIKIT\",\"kind\":\"MEDIKIT\"},\"value\":4}],\"righthand\":[{\"key\":{\"description\":\"F\",\"kind\":\"ROOM\"},\"value\":5},{\"key\":{\"description\":\"D\",\"kind\":\"ROOM\"},\"value\":2}]},\"arrow\":\"LEFT\",\"trackerID\":10},{\"distance\":5,\"locationObjectMap\":[{\"key\":\"ROOM\",\"value\":[{\"description\":\"N\",\"kind\":\"ROOM\"}]}],\"locationObjects\":{\"lefthand\":[{\"key\":{\"description\":\"N\",\"kind\":\"ROOM\"},\"value\":3}],\"righthand\":[]},\"arrow\":\"BACKWARDS\",\"trackerID\":7}],\"id\":4,\"trackers\":[9,10,7]},\"5\":{\"directions\":[{\"distance\":8,\"locationObjectMap\":[{\"key\":\"ROOM\",\"value\":[{\"description\":\"H\",\"kind\":\"ROOM\"},{\"description\":\"T\",\"kind\":\"ROOM\"}]}],\"locationObjects\":{\"lefthand\":[{\"key\":{\"description\":\"T\",\"kind\":\"ROOM\"},\"value\":5}],\"righthand\":[{\"key\":{\"description\":\"H\",\"kind\":\"ROOM\"},\"value\":3}]},\"arrow\":\"RIGHT\",\"trackerID\":3},{\"distance\":3,\"locationObjectMap\":[{\"key\":\"TOILET\",\"value\":[{\"description\":\"MALE\",\"kind\":\"TOILET\"}]}],\"locationObjects\":{\"lefthand\":[],\"righthand\":[{\"key\":{\"description\":\"MALE\",\"kind\":\"TOILET\"},\"value\":3}]},\"arrow\":\"BACKWARDS\",\"trackerID\":11},{\"distance\":9,\"locationObjectMap\":[{\"key\":\"ROOM\",\"value\":[{\"description\":\"J\",\"kind\":\"ROOM\"}]},{\"key\":\"EMERGENCYEXIT\",\"value\":[{\"description\":\"EMERGENCYEXIT\",\"kind\":\"EMERGENCYEXIT\"}]}],\"locationObjects\":{\"lefthand\":[{\"key\":{\"description\":\"J\",\"kind\":\"ROOM\"},\"value\":8}],\"righthand\":[{\"key\":{\"description\":\"EMERGENCYEXIT\",\"kind\":\"EMERGENCYEXIT\"},\"value\":3}]},\"arrow\":\"LEFT\",\"trackerID\":8}],\"id\":5,\"trackers\":[3,11,8]},\"6\":{\"directions\":[{\"distance\":8,\"locationObjectMap\":[{\"key\":\"TOILET\",\"value\":[{\"description\":\"HANDICAPPED\",\"kind\":\"TOILET\"}]},{\"key\":\"ROOM\",\"value\":[{\"description\":\"A\",\"kind\":\"ROOM\"}]},{\"key\":\"MEDIKIT\",\"value\":[{\"description\":\"MEDIKIT\",\"kind\":\"MEDIKIT\"}]}],\"locationObjects\":{\"lefthand\":[{\"key\":{\"description\":\"A\",\"kind\":\"ROOM\"},\"value\":5},{\"key\":{\"description\":\"MEDIKIT\",\"kind\":\"MEDIKIT\"},\"value\":3}],\"righthand\":[{\"key\":{\"description\":\"HANDICAPPED\",\"kind\":\"TOILET\"},\"value\":6}]},\"arrow\":\"LEFT\",\"trackerID\":1},{\"distance\":4,\"locationObjectMap\":[{\"key\":\"TOILET\",\"value\":[{\"description\":\"FEMAIL\",\"kind\":\"TOILET\"}]},{\"key\":\"ROOM\",\"value\":[{\"description\":\"B\",\"kind\":\"ROOM\"}]}],\"locationObjects\":{\"lefthand\":[{\"key\":{\"description\":\"FEMAIL\",\"kind\":\"TOILET\"},\"value\":1}],\"righthand\":[{\"key\":{\"description\":\"B\",\"kind\":\"ROOM\"},\"value\":2}]},\"arrow\":\"BACKWARDS\",\"trackerID\":9},{\"distance\":11,\"locationObjectMap\":[{\"key\":\"EMERGENCYEXIT\",\"value\":[{\"description\":\"EMERGENCYEXIT\",\"kind\":\"EMERGENCYEXIT\"}]}],\"locationObjects\":{\"lefthand\":[{\"key\":{\"description\":\"EMERGENCYEXIT\",\"kind\":\"EMERGENCYEXIT\"},\"value\":9}],\"righthand\":[]},\"arrow\":\"RIGHT\",\"trackerID\":7}],\"id\":6,\"trackers\":[1,9,7]},\"7\":{\"directions\":[{\"distance\":5,\"locationObjectMap\":[{\"key\":\"ROOM\",\"value\":[{\"description\":\"N\",\"kind\":\"ROOM\"}]}],\"locationObjects\":{\"lefthand\":[],\"righthand\":[{\"key\":{\"description\":\"N\",\"kind\":\"ROOM\"},\"value\":2}]},\"arrow\":\"BACKWARDS\",\"trackerID\":4},{\"distance\":11,\"locationObjectMap\":[{\"key\":\"EMERGENCYEXIT\",\"value\":[{\"description\":\"EMERGENCYEXIT\",\"kind\":\"EMERGENCYEXIT\"}]}],\"locationObjects\":{\"lefthand\":[],\"righthand\":[{\"key\":{\"description\":\"EMERGENCYEXIT\",\"kind\":\"EMERGENCYEXIT\"},\"value\":2}]},\"arrow\":\"LEFT\",\"trackerID\":6},{\"distance\":6,\"locationObjectMap\":[{\"key\":\"ROOM\",\"value\":[{\"description\":\"L\",\"kind\":\"ROOM\"}]},{\"key\":\"FIREDRENCHER\",\"value\":[{\"description\":\"FIREDRENCHER\",\"kind\":\"FIREDRENCHER\"}]}],\"locationObjects\":{\"lefthand\":[],\"righthand\":[{\"key\":{\"description\":\"FIREDRENCHER\",\"kind\":\"FIREDRENCHER\"},\"value\":3},{\"key\":{\"description\":\"L\",\"kind\":\"ROOM\"},\"value\":2}]},\"arrow\":\"RIGHT\",\"trackerID\":8}],\"id\":7,\"trackers\":[4,6,8]},\"8\":{\"directions\":[{\"distance\":9,\"locationObjectMap\":[{\"key\":\"ROOM\",\"value\":[{\"description\":\"J\",\"kind\":\"ROOM\"}]},{\"key\":\"EMERGENCYEXIT\",\"value\":[{\"description\":\"EMERGENCYEXIT\",\"kind\":\"EMERGENCYEXIT\"}]}],\"locationObjects\":{\"lefthand\":[{\"key\":{\"description\":\"EMERGENCYEXIT\",\"kind\":\"EMERGENCYEXIT\"},\"value\":6}],\"righthand\":[{\"key\":{\"description\":\"J\",\"kind\":\"ROOM\"},\"value\":1}]},\"arrow\":\"RIGHT\",\"trackerID\":5},{\"distance\":6,\"locationObjectMap\":[{\"key\":\"ROOM\",\"value\":[{\"description\":\"L\",\"kind\":\"ROOM\"}]},{\"key\":\"FIREDRENCHER\",\"value\":[{\"description\":\"FIREDRENCHER\",\"kind\":\"FIREDRENCHER\"}]}],\"locationObjects\":{\"lefthand\":[{\"key\":{\"description\":\"FIREDRENCHER\",\"kind\":\"FIREDRENCHER\"},\"value\":3},{\"key\":{\"description\":\"L\",\"kind\":\"ROOM\"},\"value\":4}],\"righthand\":[]},\"arrow\":\"LEFT\",\"trackerID\":7},{\"distance\":5,\"locationObjectMap\":[{\"key\":\"ROOM\",\"value\":[{\"description\":\"K\",\"kind\":\"ROOM\"}]}],\"locationObjects\":{\"lefthand\":[],\"righthand\":[{\"key\":{\"description\":\"K\",\"kind\":\"ROOM\"},\"value\":2}]},\"arrow\":\"BACKWARDS\",\"trackerID\":10},{\"distance\":6,\"locationObjectMap\":[{\"key\":\"ROOM\",\"value\":[{\"description\":\"K\",\"kind\":\"ROOM\"}]}],\"locationObjects\":{\"lefthand\":[],\"righthand\":[{\"key\":{\"description\":\"K\",\"kind\":\"ROOM\"},\"value\":4}]},\"arrow\":\"BACKWARDS\",\"trackerID\":11}],\"id\":8,\"trackers\":[5,7,10,11]},\"9\":{\"directions\":[{\"distance\":4,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"BACKWARDS\",\"trackerID\":1},{\"distance\":2,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"RIGHT\",\"trackerID\":4},{\"distance\":4,\"locationObjectMap\":[{\"key\":\"TOILET\",\"value\":[{\"description\":\"FEMAIL\",\"kind\":\"TOILET\"}]},{\"key\":\"ROOM\",\"value\":[{\"description\":\"B\",\"kind\":\"ROOM\"}]}],\"locationObjects\":{\"lefthand\":[{\"key\":{\"description\":\"B\",\"kind\":\"ROOM\"},\"value\":2}],\"righthand\":[{\"key\":{\"description\":\"FEMAIL\",\"kind\":\"TOILET\"},\"value\":3}]},\"arrow\":\"LEFT\",\"trackerID\":6}],\"id\":9,\"trackers\":[1,4,6]},\"10\":{\"directions\":[{\"distance\":5,\"locationObjectMap\":[{\"key\":\"ROOM\",\"value\":[{\"description\":\"G\",\"kind\":\"ROOM\"}]}],\"locationObjects\":{\"lefthand\":[{\"key\":{\"description\":\"G\",\"kind\":\"ROOM\"},\"value\":3}],\"righthand\":[]},\"arrow\":\"BACKWARDS\",\"trackerID\":3},{\"distance\":5,\"locationObjectMap\":[{\"key\":\"ROOM\",\"value\":[{\"description\":\"M\",\"kind\":\"ROOM\"},{\"description\":\"F\",\"kind\":\"ROOM\"},{\"description\":\"D\",\"kind\":\"ROOM\"}]},{\"key\":\"MEDIKIT\",\"value\":[{\"description\":\"MEDIKIT\",\"kind\":\"MEDIKIT\"}]}],\"locationObjects\":{\"lefthand\":[{\"key\":{\"description\":\"F\",\"kind\":\"ROOM\"},\"value\":0},{\"key\":{\"description\":\"D\",\"kind\":\"ROOM\"},\"value\":3}],\"righthand\":[{\"key\":{\"description\":\"M\",\"kind\":\"ROOM\"},\"value\":3},{\"key\":{\"description\":\"MEDIKIT\",\"kind\":\"MEDIKIT\"},\"value\":1}]},\"arrow\":\"LEFT\",\"trackerID\":4},{\"distance\":5,\"locationObjectMap\":[{\"key\":\"ROOM\",\"value\":[{\"description\":\"K\",\"kind\":\"ROOM\"}]}],\"locationObjects\":{\"lefthand\":[{\"key\":{\"description\":\"K\",\"kind\":\"ROOM\"},\"value\":3}],\"righthand\":[]},\"arrow\":\"FORWARDS\",\"trackerID\":8},{\"distance\":2,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"RIGHT\",\"trackerID\":11}],\"id\":10,\"trackers\":[3,4,8,11]},\"11\":{\"directions\":[{\"distance\":4,\"locationObjectMap\":[{\"key\":\"ROOM\",\"value\":[{\"description\":\"G\",\"kind\":\"ROOM\"}]}],\"locationObjects\":{\"lefthand\":[{\"key\":{\"description\":\"G\",\"kind\":\"ROOM\"},\"value\":2}],\"righthand\":[]},\"arrow\":\"FORWARDS\",\"trackerID\":3},{\"distance\":3,\"locationObjectMap\":[{\"key\":\"TOILET\",\"value\":[{\"description\":\"MALE\",\"kind\":\"TOILET\"}]}],\"locationObjects\":{\"lefthand\":[{\"key\":{\"description\":\"MALE\",\"kind\":\"TOILET\"},\"value\":0}],\"righthand\":[]},\"arrow\":\"LEFT\",\"trackerID\":5},{\"distance\":6,\"locationObjectMap\":[{\"key\":\"ROOM\",\"value\":[{\"description\":\"K\",\"kind\":\"ROOM\"}]}],\"locationObjects\":{\"lefthand\":[{\"key\":{\"description\":\"K\",\"kind\":\"ROOM\"},\"value\":2}],\"righthand\":[]},\"arrow\":\"BACKWARDS\",\"trackerID\":8},{\"distance\":2,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"RIGHT\",\"trackerID\":10}],\"id\":11,\"trackers\":[3,5,8,10]}}},\"locationOnly\":{\"name\":\"Muster_Name\",\"number\":\"999\",\"place\":\"Muster_Ort\",\"street\":\"Muster_Straße\",\"zip\":\"99999\"},\"name\":\"Muster_Name\",\"number\":\"999\",\"place\":\"Muster_Ort\",\"street\":\"Muster_Straße\",\"zip\":\"99999\"}";
        //return "{\"history\":{\"lObjectMap\":[{\"key\":\"ROOM\",\"value\":[{\"description\":\"AD15\",\"kind\":\"ROOM\"},{\"description\":\"AD21\",\"kind\":\"ROOM\"},{\"description\":\"AD20\",\"kind\":\"ROOM\"},{\"description\":\"AD19\",\"kind\":\"ROOM\"},{\"description\":\"AB8\",\"kind\":\"ROOM\"},{\"description\":\"AB7\",\"kind\":\"ROOM\"},{\"description\":\"AB5\",\"kind\":\"ROOM\"}]},{\"key\":\"TOILET\",\"value\":[{\"description\":\"FEMAIL\",\"kind\":\"TOILET\"},{\"description\":\"HANDICAPPED\",\"kind\":\"TOILET\"},{\"description\":\"MALE\",\"kind\":\"TOILET\"}]}],\"trackerMap\":{\"1\":{\"directions\":[{\"distance\":27,\"locationObjectMap\":[{\"key\":\"TOILET\",\"value\":[{\"description\":\"FEMAIL\",\"kind\":\"TOILET\"},{\"description\":\"HANDICAPPED\",\"kind\":\"TOILET\"},{\"description\":\"MALE\",\"kind\":\"TOILET\"}]}],\"locationObjects\":{\"lefthand\":[],\"righthand\":[{\"key\":{\"description\":\"FEMAIL\",\"kind\":\"TOILET\"},\"value\":5},{\"key\":{\"description\":\"HANDICAPPED\",\"kind\":\"TOILET\"},\"value\":10},{\"key\":{\"description\":\"MALE\",\"kind\":\"TOILET\"},\"value\":15}]},\"arrow\":\"LEFT\",\"trackerID\":2}],\"id\":1,\"trackers\":[2]},\"2\":{\"directions\":[{\"distance\":27,\"locationObjectMap\":[{\"key\":\"TOILET\",\"value\":[{\"description\":\"FEMAIL\",\"kind\":\"TOILET\"},{\"description\":\"HANDICAPPED\",\"kind\":\"TOILET\"},{\"description\":\"MALE\",\"kind\":\"TOILET\"}]}],\"locationObjects\":{\"lefthand\":[{\"key\":{\"description\":\"FEMAIL\",\"kind\":\"TOILET\"},\"value\":22},{\"key\":{\"description\":\"HANDICAPPED\",\"kind\":\"TOILET\"},\"value\":17},{\"key\":{\"description\":\"MALE\",\"kind\":\"TOILET\"},\"value\":12}],\"righthand\":[]},\"arrow\":\"RIGHT\",\"trackerID\":1},{\"distance\":25,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"BACKWARDS_LEFT\",\"trackerID\":3}],\"id\":2,\"trackers\":[1,3]},\"3\":{\"directions\":[{\"distance\":25,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"BACKWARDS\",\"trackerID\":2},{\"distance\":0,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"RIGHT\",\"trackerID\":0},{\"distance\":29,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"LEFT\",\"trackerID\":4}],\"id\":3,\"trackers\":[2,4]},\"4\":{\"directions\":[{\"distance\":29,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"RIGHT\",\"trackerID\":3},{\"distance\":8,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"BACKWARDS\",\"trackerID\":5},{\"distance\":40,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"LEFT\",\"trackerID\":6}],\"id\":4,\"trackers\":[3,5,6]},\"5\":{\"directions\":[{\"distance\":8,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"LEFT\",\"trackerID\":4},{\"distance\":40,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"UP\",\"trackerID\":13}],\"id\":5,\"trackers\":[4,13]},\"6\":{\"directions\":[{\"distance\":40,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"RIGHT\",\"trackerID\":4},{\"distance\":43,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"LEFT\",\"trackerID\":7}],\"id\":6,\"trackers\":[4,7]},\"7\":{\"directions\":[{\"distance\":43,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"BACKWARDS\",\"trackerID\":6},{\"distance\":30,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"LEFT_UP\",\"trackerID\":8}],\"id\":7,\"trackers\":[6,8]},\"8\":{\"directions\":[{\"distance\":30,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"RIGHT_DOWN\",\"trackerID\":7},{\"distance\":13,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"RIGHT\",\"trackerID\":10},{\"distance\":0,\"locationObjectMap\":[{\"key\":\"ROOM\",\"value\":[{\"description\":\"AB5\",\"kind\":\"ROOM\"},{\"description\":\"AB7\",\"kind\":\"ROOM\"},{\"description\":\"AB8\",\"kind\":\"ROOM\"}]}],\"locationObjects\":{\"lefthand\":[],\"righthand\":[{\"key\":{\"description\":\"AB5\",\"kind\":\"ROOM\"},\"value\":13},{\"key\":{\"description\":\"AB7\",\"kind\":\"ROOM\"},\"value\":10},{\"key\":{\"description\":\"AB8\",\"kind\":\"ROOM\"},\"value\":5}]},\"arrow\":\"LEFT\",\"trackerID\":0}],\"id\":8,\"trackers\":[7,10]},\"10\":{\"directions\":[{\"distance\":30,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"LEFT_UP\",\"trackerID\":17},{\"distance\":13,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"LEFT\",\"trackerID\":8}],\"id\":10,\"trackers\":[17,8]},\"12\":{\"directions\":[{\"distance\":12,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"RIGHT\",\"trackerID\":13},{\"distance\":24,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"LEFT_UP\",\"trackerID\":14}],\"id\":12,\"trackers\":[13,14]},\"13\":{\"directions\":[{\"distance\":40,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"DOWN\",\"trackerID\":5},{\"distance\":12,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"LEFT\",\"trackerID\":12}],\"id\":13,\"trackers\":[5,12]},\"14\":{\"directions\":[{\"distance\":24,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"RIGHT_DOWN\",\"trackerID\":12},{\"distance\":24,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"LEFT_UP\",\"trackerID\":23}],\"id\":14,\"trackers\":[12,23]},\"16\":{\"directions\":[{\"distance\":30,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"LEFT_UP\",\"trackerID\":20},{\"distance\":14,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"LEFT\",\"trackerID\":17}],\"id\":16,\"trackers\":[20,17]},\"17\":{\"directions\":[{\"distance\":14,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"RIGHT\",\"trackerID\":16},{\"distance\":30,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"RIGHT_DOWN\",\"trackerID\":10}],\"id\":17,\"trackers\":[16,10]},\"20\":{\"directions\":[{\"distance\":14,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"RIGHT\",\"trackerID\":22},{\"distance\":30,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"RIGHT_DOWN\",\"trackerID\":16}],\"id\":20,\"trackers\":[22,16]},\"22\":{\"directions\":[{\"distance\":43,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"BACKWARDS\",\"trackerID\":23},{\"distance\":14,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"LEFT\",\"trackerID\":20}],\"id\":22,\"trackers\":[23,20]},\"23\":{\"directions\":[{\"distance\":24,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"RIGHT_DOWN\",\"trackerID\":14},{\"distance\":28,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"RIGHT\",\"trackerID\":24},{\"distance\":43,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"LEFT\",\"trackerID\":22}],\"id\":23,\"trackers\":[14,24,22]},\"24\":{\"directions\":[{\"distance\":28,\"locationObjectMap\":[],\"locationObjects\":{\"lefthand\":[],\"righthand\":[]},\"arrow\":\"LEFT\",\"trackerID\":23},{\"distance\":0,\"locationObjectMap\":[{\"key\":\"ROOM\",\"value\":[{\"description\":\"AD15\",\"kind\":\"ROOM\"},{\"description\":\"AD20\",\"kind\":\"ROOM\"},{\"description\":\"AD19\",\"kind\":\"ROOM\"},{\"description\":\"AD21\",\"kind\":\"ROOM\"}]}],\"locationObjects\":{\"lefthand\":[{\"key\":{\"description\":\"AD15\",\"kind\":\"ROOM\"},\"value\":4}],\"righthand\":[{\"key\":{\"description\":\"AD20\",\"kind\":\"ROOM\"},\"value\":6},{\"key\":{\"description\":\"AD19\",\"kind\":\"ROOM\"},\"value\":10},{\"key\":{\"description\":\"AD21\",\"kind\":\"ROOM\"},\"value\":2}]},\"arrow\":\"RIGHT\",\"trackerID\":0}],\"id\":24,\"trackers\":[23]}}},\"locationOnly\":{\"name\":\"FHWS\",\"number\":\"20\",\"place\":\"Würzburg\",\"street\":\"SHL\",\"zip\":\"97074\"},\"name\":\"FHWS\",\"number\":\"20\",\"place\":\"Würzburg\",\"street\":\"SHL\",\"zip\":\"97074\"}";
        return TestLocation.SHL;
    }

    private String doGetRequest(String address){
        HttpURLConnection urlConnection = null;
        try{
            URL url = new URL(address);
            urlConnection = (HttpURLConnection) url.openConnection();
            urlConnection.addRequestProperty("Content-Type", "application/json");
            urlConnection.setRequestMethod("GET");
            InputStream is = urlConnection.getInputStream();
            return IOUtils.toString(is);
        } catch (Exception ex) {
            Log.e(NetworkCommunikation.class.getSimpleName(), "" + ex.getMessage());
        }finally {
            urlConnection.disconnect();
        }
        return "";
    }

    private void updateCookieManager(HttpURLConnection urlConnection){
        msCookieManager = new CookieManager();
        Map<String, List<String>> headerFields = urlConnection.getHeaderFields();
        List<String> cookiesHeader = headerFields.get("Set-Cookie");
        if(cookiesHeader != null)
        {
            for (String cookie : cookiesHeader){
                msCookieManager.getCookieStore().add(null, HttpCookie.parse(cookie).get(0));
            }
        }
    }

    private void updateHttpURLConnection(HttpURLConnection urlConnection){
        if(msCookieManager.getCookieStore().getCookies().size() > 0)        {
            urlConnection.setRequestProperty("Cookie",
                    TextUtils.join(",", msCookieManager.getCookieStore().getCookies()));
        }
    }

    @Override
    protected void onPostExecute(String result) {
        super.onPostExecute(result);
        Log.d(NetworkCommunikation.class.getSimpleName(), "Result: "  + result);
        Location location = Location.JsonToLocation(result);
        customListener.getDatabase().addLocation(location);
        activity.showFragment(new ListLocationFragment(), StartMenuActivity.LOCATIONFRAGMENT);
    }
}


